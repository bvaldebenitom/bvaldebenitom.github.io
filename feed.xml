<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="https://bvaldebenitom.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://bvaldebenitom.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2024-01-06T15:43:36+00:00</updated><id>https://bvaldebenitom.github.io/feed.xml</id><title type="html">blank</title><subtitle>A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. </subtitle><entry><title type="html">Automatization of IGV snapshots</title><link href="https://bvaldebenitom.github.io/blog/2024/igv_coverage/" rel="alternate" type="text/html" title="Automatization of IGV snapshots"/><published>2024-01-06T09:40:00+00:00</published><updated>2024-01-06T09:40:00+00:00</updated><id>https://bvaldebenitom.github.io/blog/2024/igv_coverage</id><content type="html" xml:base="https://bvaldebenitom.github.io/blog/2024/igv_coverage/"><![CDATA[<p>Ever since I started analyzing Transposable Elements (TEs) expression in RNA-Seq data, I have been curious to see the genomic coverage of specific loci. Moreover, when I found out that SQuIRE[https://academic.oup.com/nar/article/47/5/e27/5280934], one of the best tools at the moment, could generate thousands of false positives, I was more aware of the need to manually verify the expression of TEs. Since there was a large amount of loci to check, I would always postpone this task, as I was never able to find an automated way of generating genomic coverage snapshots. Instead, after several statistical analyses, I would try to shorten the list of TEs to the smallest amount possible, so I could later check them one-by-one on the Integrative Genomics Viewer (IGV) application.</p> <p>It wasn’t until a few weeks ago that I decided to attempt this again. In turn, I was able to find this blog post[https://janbio.home.blog/2020/09/16/igv-batch-snapshot-from-command-line/] with the backbone of the solution. Since then, I modified it to suit my needs for RNA-Seq analyses, and decided to write this post as a more definite tutorial that goes from scratch to the final generation of these long-coveted automated IGV snapshots.</p> <ol> <li>What you will need</li> </ol> <p>Command line IGV 2.16.2 [https://igv.org/doc/desktop/#DownloadPage/] Samtools [https://www.htslib.org/] A genome FASTA file (for this tutorial, I’m using the mm10 FASTA[https://hgdownload.soe.ucsc.edu/goldenPath/mm10/bigZips/]) A GTF file (for this tutorial, I’m using the mm10 NCBI RefSeq[https://hgdownload.soe.ucsc.edu/goldenPath/mm10/bigZips/genes/mm10.ncbiRefSeq.gtf.gz] annotation) One or more BAM files (I’m using 2 BAM files here)</p> <ol> <li>Generating the snapshots</li> </ol> <p>There are two main steps to actually generating the IGV snapshots in an automated manner. First, we need to index the genome FASTA file, the genome annotation GTF file, and the BAM files.</p> <p>To make things simpler, I recommend creating an environment variable that contains the path to the IGV command line directory:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">bash
</span><span class="nb">export </span><span class="nv">IGV_HOME</span><span class="o">=</span>/path/IGV_2.16.2/
<span class="p">```</span>
</code></pre></div></div> <p>Then, to index the genome FASTA file, we can do it like this:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$IGV_HOME/igvtools index mm10.fa
</code></pre></div></div> <p>For the GTF file, we need to sort it first, and then we can run the index command: $IGV_HOME/igvtools sort mm10.ncbiRefSeq.gtf mm10.ncbiRefSeq_sorted.gtf $IGV_HOME/igvtools index mm10.ncbiRefSeq_sorted.gtf</p> <p>WARNING: Failure to index the GTF file, will result in long running times. Although the snapshot commands will work, when testing this tutorial on the unindexed file, it went for more than 26 minutes when loading it, in comparison to the ~1 minute it will take with the sorted and indexed version.</p> <p>Finally, to index the BAM files, we can use samtools: samtools index W8S1PA_Aligned.sortedByCoord.out.bam samtools index W8S3SM_Aligned.sortedByCoord.out.bam</p> <p>The second step is creating the IGV script that will be used to actually generate the snapshots. Here is the template I use now:</p> <p>#load files genome mm10.fa load mm10.ncbiRefSeq_sorted.gtf</p> <p>preference SAM.SHOW_ALIGNMENT_TRACK false</p> <p>load W8S3SM_Aligned.sortedByCoord.out.bam load W8S1PA_Aligned.sortedByCoord.out.bam</p> <p>#create snapshots snapshotDirectory .</p> <p>goto chr3:83,764,321-83,776,316 snapshot igv_demo_sfrp2.png</p> <p>exit</p> <p>We can save this into the file igv_snapshot_demo.batch. The script basically consists of loading the genome files (FASTA and sorted GTF), then setting SAM.SHOW_ALIGNMENT_TRACK to false, as I don’t usually need to check the reads track, and loading the BAM files. Later, we define the snapshot directory, and through the goto and snapshot commands we are actually creating them.</p> <p>Once all the above is done, we can run this final command to efficiently generate all the snapshots in one go: xvfb-run –auto-servernum –server-num=1 java -showversion –module-path=”${IGV_HOME}/lib” -Xmx8g @”${IGV_HOME}/igv.args” –module=org.igv/org.broad.igv.ui.Main -b igv_snapshot_demo.batch</p> <p>In this exmaple, the final snapshot generated will be:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/igv_tutorial_sfrp2-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/igv_tutorial_sfrp2-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/igv_tutorial_sfrp2-1400.webp"/> <img src="/assets/img/igv_tutorial_sfrp2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> A simple, elegant caption looks good between image rows, after each row, or doesn't have to be there at all. </div>]]></content><author><name></name></author><category term="tutorials"/><category term="rnaseq"/><summary type="html"><![CDATA[A tutorial on best practices and how to do command line automatization of genomic coverage snapshots using the Integrative Genomics Viewer]]></summary></entry></feed>